name: Send Personalized Emails
on:
  workflow_dispatch:
    inputs:
      contacts:
        description: 'Contacts CSV path (relative)'
        required: true
        default: 'contacts/adults/EduAdultList.csv'
      template:
        description: 'Template DOCX path (relative)'
        required: true
        default: 'campaign-templates/adults/Adult-Education.docx'
      subject:
        description: 'Email subject'
        required: true
        default: 'Collaboration Opportunity'
      dry_run:
        description: 'Dry run (true/false)'
        required: true
        default: 'true'
      delay:
        description: 'Delay between emails (seconds)'
        required: false
        default: '1.5'
jobs:
  send:
    runs-on: ubuntu-latest
    env:
      SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
      SMTP_PORT: ${{ secrets.SMTP_PORT }}
      SMTP_USERNAME: ${{ secrets.SMTP_USER }}
      SMTP_PASSWORD: ${{ secrets.SMTP_PASS }}
      MAIL_FROM: ${{ secrets.MAIL_FROM }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Send personalized emails
        run: |
          python .github/scripts/send_personalized_emails.py \
            --contacts "${{ github.event.inputs.contacts }}" \
            --template "${{ github.event.inputs.template }}" \
            --subject "${{ github.event.inputs.subject }}" \
            --delay ${{ github.event.inputs.delay || '1.5' }} \
            ${{ github.event.inputs.dry_run == 'true' && '--dry-run' || '' }}

