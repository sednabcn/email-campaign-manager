name: üìÑ Preview CSV Contacts Only

on:
  workflow_dispatch:
    inputs:
      rows_to_show:
        description: 'Number of rows to preview from extracted CSV'
        required: false
        default: 10
        type: number
      debug:
        description: 'Enable debug logging'
        required: false
        default: false
        type: boolean

permissions:
  contents: read

jobs:
  contact-extraction:
    uses: sednabcn/services/.github/workflows/contact-extractor.yml@dev
    with:
      source_directory: "contact_details"
      output_directory: "contacts"

  preview:
    runs-on: ubuntu-latest
    needs: contact-extraction

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download contact extraction results
        uses: actions/download-artifact@v4
        with:
          name: latest-contact-extraction-results
          path: ./contacts

      - name: Preview extracted CSV
        run: |
          echo "üîç Looking for CSV in ./contacts/"
          CSV_FILE=$(find ./contacts -type f -name "*.csv" | sort | tail -1)

          if [ -z "$CSV_FILE" ]; then
            echo "‚ùå No CSV files found"
            exit 1
          fi

          echo "‚úÖ Found: $CSV_FILE"
          echo ""
          echo "üìä Preview of first ${{ inputs.rows_to_show }} lines:"
          head -n ${{ inputs.rows_to_show }} "$CSV_FILE"
          echo ""
          echo "üì¶ Total rows (excluding header):"
          tail -n +2 "$CSV_FILE" | wc -l
